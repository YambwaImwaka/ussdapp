<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USSD Payment System</title>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 20px;
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        h1, h2 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }

        label {
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
            color: #555;
        }

        input, select, button {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 16px;
        }

        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #45a049;
        }

        .secondary-button {
            background-color: #2196F3;
        }

        .secondary-button:hover {
            background-color: #0b7dda;
        }

        .log-entry {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
            color: #555;
        }

        .log-entry:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>USSD Payment System</h1>

        <!-- SIM Slot Selection -->
        <label for="simSlots">Choose SIM:</label>
        <select id="simSlots"></select>

        <!-- Payment Inputs -->
        <label for="amount">Amount:</label>
        <input type="number" id="amount" placeholder="Enter payment amount" />

        <label for="merchantCode">Merchant Code:</label>
        <input type="text" id="merchantCode" placeholder="Enter merchant code (e.g., 12345)" />

        <!-- Action Buttons -->
        <button onclick="initiatePayment()">Pay Now</button>
        <button class="secondary-button" onclick="fetchStoredSMS()">Fetch Stored SMS</button>
        <button class="secondary-button" onclick="sendDebugData()">Send Debug Data</button>

        <!-- Transaction Log -->
        <h2>Transaction Log</h2>
        <div id="transactionLog" class="transaction-log"></div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            if (window.android && android.fetchSIMSlots) {
                android.fetchSIMSlots();
            } else {
                alert("Android interface not available.");
            }
        });

        function populateSIMSlots(json) {
            try {
                const slots = JSON.parse(json);
                const select = document.getElementById("simSlots");
                select.innerHTML = "";

                if (Object.keys(slots).length === 0) {
                    const option = document.createElement("option");
                    option.text = "No active SIMs available";
                    option.disabled = true;
                    option.selected = true;
                    select.add(option);
                } else {
                    Object.entries(slots).forEach(([index, name]) => {
                        const option = document.createElement("option");
                        option.value = index;
                        option.text = name;
                        select.add(option);
                    });
                }
            } catch (error) {
                console.error("Error populating SIM slots:", error);
                alert("Error populating SIM slots: " + error.message);
            }
        }

        function initiatePayment() {
            const simSlot = document.getElementById("simSlots").value;
            const amount = document.getElementById("amount").value;
            const merchantCode = document.getElementById("merchantCode").value;

            if (!simSlot) {
                alert("Please select a SIM slot.");
                return;
            }
            if (!amount || amount <= 0) {
                alert("Please enter a valid payment amount.");
                return;
            }
            if (!merchantCode) {
                alert("Please enter a valid merchant code.");
                return;
            }

            const payload = JSON.stringify({
                simSlot,
                ussdCode: `*115*8*${merchantCode}*${amount}#`
            });

            if (window.android && android.dialThis) {
                android.dialThis(payload);
            } else {
                alert("Android interface not available.");
            }
        }

        function fetchStoredSMS() {
            if (window.android && android.fetchStoredSMS) {
                android.fetchStoredSMS();
            } else {
                alert("Android interface not available.");
            }
        }

        function displayFetchedSMS(json) {
            try {
                const messages = JSON.parse(json);
                const logDiv = document.getElementById("transactionLog");
                logDiv.innerHTML = "";

                messages.forEach((message) => {
                    const logEntry = document.createElement("div");
                    logEntry.textContent = `TID: ${message.transactionId}, Amount: ${message.amount}, Status: ${message.status}`;
                    logDiv.appendChild(logEntry);
                });
            } catch (error) {
                console.error("Error displaying fetched SMS:", error);
                alert("Error displaying fetched SMS: " + error.message);
            }
        }

        function sendDebugData() {
            if (window.android && android.sendDebugData) {
                android.sendDebugData();
            } else {
                alert("Android interface not available.");
            }
        }
    </script>
</body>
</html>